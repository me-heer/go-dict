<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
	<title>No Fluff Dictionary</title>
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="default">
	<meta name="color-scheme" content="light dark">

	<!-- Favicon -->
	<link rel="icon" Add comment More actions
		href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ¯</text></svg>">

	<style>
		:root {
			/* Light theme colors */
			--ios-background: #f2f2f7;
			--ios-card: #ffffff;
			--ios-text: #000000;
			--ios-text-secondary: #8e8e93;
			--ios-blue: #007aff;
			--ios-red: #ff3b30;
			--ios-border: rgba(60, 60, 67, 0.1);
			--ios-shadow: rgba(0, 0, 0, 0.05);
			--ios-input-bg: rgba(142, 142, 147, 0.12);
			--ios-input-bg-focus: rgba(142, 142, 147, 0.18);
		}

		@media (prefers-color-scheme: dark) {
			:root {
				/* Dark theme colors */
				--ios-background: #000000;
				--ios-card: #1c1c1e;
				--ios-text: #ffffff;
				--ios-text-secondary: #8e8e93;
				--ios-blue: #0a84ff;
				--ios-red: #ff453a;
				--ios-border: rgba(84, 84, 88, 0.6);
				--ios-shadow: rgba(0, 0, 0, 0.3);
				--ios-input-bg: rgba(118, 118, 128, 0.24);
				--ios-input-bg-focus: rgba(118, 118, 128, 0.32);
			}
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			-webkit-font-smoothing: antialiased;
			-moz-osx-font-smoothing: grayscale;
		}

		body {
			font-family: -apple-system, BlinkMacSystemFont, "San Francisco", "Helvetica Neue", sans-serif;
			line-height: 1.5;
			color: var(--ios-text);
			background-color: var(--ios-background);
			padding-top: env(safe-area-inset-top);
			padding-bottom: env(safe-area-inset-bottom);
		}

		.container {
			max-width: 750px;
			margin: 0 auto;
			padding: 1.5rem 1rem;
			min-height: 100vh;
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
		}

		.search-section {
			width: 100%;
			max-width: 600px;
			text-align: center;
			margin-bottom: 1rem;
		}

		.search-form {
			display: flex;
			width: 100%;
		}

		.search-container {
			position: relative;
			width: 100%;
		}

		.search-icon {
			position: absolute;
			left: 0.75rem;
			top: 50%;
			transform: translateY(-50%);
			color: var(--ios-text-secondary);
			width: 1rem;
			height: 1rem;
		}

		.search-container input {
			width: 100%;
			padding: 1rem 0.75rem 1rem 2.5rem;
			border: none;
			border-radius: 12px;
			font-size: 1.1rem;
			background-color: var(--ios-input-bg);
			color: var(--ios-text);
			-webkit-appearance: none;
			appearance: none;
		}

		.search-container input:focus {
			outline: none;
			background-color: var(--ios-input-bg-focus);
		}

		.search-container input::placeholder {
			color: var(--ios-text-secondary);
		}

		button {
			padding: 0.75rem 1rem;
			background-color: var(--ios-blue);
			color: white;
			border: none;
			border-radius: 12px;
			font-size: 1rem;
			font-weight: 600;
			cursor: pointer;
			-webkit-appearance: none;
			appearance: none;
		}

		button:hover {
			background-color: #0056d6;
		}

		button:active {
			background-color: #004bb8;
		}

		button:disabled {
			opacity: 0.5;
			cursor: not-allowed;
		}

		.loading {
			text-align: center;
			padding: 1rem;
			color: var(--ios-text-secondary);
			font-weight: 500;
			font-size: 1rem;
			display: none;
		}

		.loading.show {
			display: block;
		}

		.error-card {
			background-color: rgba(255, 59, 48, 0.1);
			border: 1px solid rgba(255, 59, 48, 0.2);
			border-radius: 12px;
			color: var(--ios-red);
			padding: 1rem 1.25rem;
			margin-top: 1rem;
			box-shadow: 0 2px 10px var(--ios-shadow);
			width: 100%;
			max-width: 500px;
		}

		.error-actions {
			margin-top: 1rem;
			display: flex;
			justify-content: center;
		}

		.search-google-btn {
			display: inline-flex;
			align-items: center;
			gap: 0.5rem;
			padding: 0.5rem 1rem;
			background-color: var(--ios-blue);
			color: white;
			text-decoration: none;
			border-radius: 8px;
			font-size: 0.9rem;
			font-weight: 500;
			transition: background-color 0.2s ease;
		}

		.search-google-btn:hover {
			background-color: #0056d6;
		}

		.search-google-btn svg {
			width: 14px;
			height: 14px;
		}

		.welcome-container {
			margin-top: 1.5rem;
			width: 100%;
			max-width: 700px;
			align-self: flex-start;
		}

		.welcome-card {
			background-color: var(--ios-card);
			border-radius: 16px;
			padding: 1.5rem;
			margin-bottom: 1.5rem;
			box-shadow: 0 4px 20px var(--ios-shadow);
			border: 1px solid var(--ios-border);
		}

		.welcome-header {
			display: flex;
			align-items: baseline;
			gap: 0.75rem;
			margin-bottom: 1rem;
			flex-wrap: wrap;
		}

		.welcome-title {
			font-size: 2rem;
			font-weight: 700;
			letter-spacing: -0.5px;
			color: var(--ios-text);
		}

		.welcome-badge {
			display: inline-flex;
			align-items: center;
			gap: 0.25rem;
			padding: 0.25rem 0.5rem;
			background-color: var(--ios-blue);
			color: white;
			border-radius: 6px;
			font-size: 0.8rem;
			font-weight: 500;
		}

		.welcome-section {
			margin-top: 1.5rem;
			padding-top: 1.5rem;
			border-top: 1px solid var(--ios-border);
		}

		.welcome-description {
			font-size: 1.1rem;
			line-height: 1.6;
			color: var(--ios-text);
			margin-bottom: 1rem;
		}

		.welcome-features {
			margin-top: 1rem;
		}

		.feature-item {
			display: flex;
			align-items: center;
			gap: 0.5rem;
			margin-bottom: 0.75rem;
			font-size: 1rem;
			color: var(--ios-text);
		}

		.feature-item svg {
			width: 16px;
			height: 16px;
			color: var(--ios-blue);
			flex-shrink: 0;
		}

		.repo-link {
			display: inline-flex;
			align-items: center;
			gap: 0.5rem;
			color: var(--ios-blue);
			text-decoration: none;
			font-weight: 500;
		}

		.repo-link:hover {
			text-decoration: underline;
		}

		.repo-link svg {
			width: 16px;
			height: 16px;
		}

		.results-container {
			margin-top: 1.5rem;
			width: 100%;
			max-width: 700px;
			align-self: flex-start;
		}

		.word-card {
			background-color: var(--ios-card);
			border-radius: 16px;
			padding: 1.5rem;
			margin-bottom: 1.5rem;
			box-shadow: 0 4px 20px var(--ios-shadow);
			border: 1px solid var(--ios-border);
		}

		.word-header {
			display: flex;
			align-items: baseline;
			gap: 0.75rem;
			margin-bottom: 1rem;
			flex-wrap: wrap;
		}

		.word-title {
			font-size: 2rem;
			font-weight: 700;
			letter-spacing: -0.5px;
			color: var(--ios-text);
		}

		.google-search-link {
			display: inline-flex;
			align-items: center;
			gap: 0.25rem;
			padding: 0.25rem 0.5rem;
			background-color: var(--ios-input-bg);
			color: var(--ios-text-secondary);
			text-decoration: none;
			border-radius: 6px;
			font-size: 0.8rem;
			font-weight: 500;
			transition: background-color 0.2s ease, color 0.2s ease;
		}

		.google-search-link:hover {
			background-color: var(--ios-input-bg-focus);
			color: var(--ios-text);
		}

		.google-search-link svg {
			width: 12px;
			height: 12px;
		}

		.phonetic {
			font-size: 1rem;
			color: var(--ios-text-secondary);
			font-weight: 400;
		}

		.audio-container {
			margin: 1rem 0;
			display: flex;
			align-items: center;
		}

		.audio-container audio {
			display: none;
		}

		.replay-button {
			display: flex;
			align-items: center;
			gap: 0.5rem;
			padding: 0.5rem 1rem;
			background-color: var(--ios-input-bg);
			color: var(--ios-blue);
			border-radius: 20px;
			font-size: 0.9rem;
			font-weight: 500;
			box-shadow: none;
		}

		.replay-button:hover {
			background-color: var(--ios-input-bg-focus);
		}

		.replay-button.highlight {
			background-color: rgba(0, 122, 255, 0.1);
			box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.2);
		}

		.meaning-section {
			margin-top: 1.5rem;
			padding-top: 1.5rem;
			border-top: 1px solid var(--ios-border);
		}

		.part-of-speech {
			font-size: 1.1rem;
			font-weight: 600;
			font-style: italic;
			margin-bottom: 0.75rem;
			color: var(--ios-blue);
		}

		.definitions-list {
			padding-left: 1.5rem;
			list-style-type: decimal;
		}

		.definition-item {
			padding-left: 0.5rem;
			margin-bottom: 1rem;
		}

		.definition {
			margin-bottom: 0.25rem;
			line-height: 1.5;
			color: var(--ios-text);
		}

		.example {
			color: var(--ios-text-secondary);
			font-style: italic;
			margin-top: 0.5rem;
			padding-left: 0.5rem;
			border-left: 2px solid var(--ios-border);
		}

		.synonyms {
			margin-top: 0.5rem;
			font-size: 0.9rem;
		}

		.synonyms .label {
			font-weight: 500;
			color: var(--ios-text);
		}

		.synonyms span:not(.label) {
			color: var(--ios-blue);
		}

		/* Vocabulary Section Styles */
		.vocabulary-section {
			width: 100%;
			max-width: 500px;
			margin-top: 0.5rem;
			margin-bottom: 1rem;
		}

		.vocabulary-toggle {
			width: 100%;
			display: flex;
			justify-content: center;
			align-items: center;
			gap: 0.5rem;
			padding: 0.5rem;
			background-color: transparent;
			color: var(--ios-blue);
			border: none;
			border-radius: 8px;
			font-size: 0.9rem;
			font-weight: 600;
			cursor: pointer;
			box-shadow: none;
		}

		.vocabulary-toggle:hover {
			background-color: rgba(0, 122, 255, 0.05);
		}

		.vocabulary-toggle.active {
			background-color: rgba(0, 122, 255, 0.1);
		}

		.toggle-icon {
			transition: transform 0.2s ease;
		}

		.vocabulary-toggle.active .toggle-icon {
			transform: rotate(180deg);
		}

		.vocabulary-list {
			margin-top: 0.5rem;
			padding: 0.75rem;
			background-color: var(--ios-card);
			border-radius: 12px;
			border: 1px solid var(--ios-border);
			box-shadow: 0 4px 12px var(--ios-shadow);
		}

		.vocabulary-list.hidden {
			display: none;
		}

		.history-list {
			display: flex;
			flex-wrap: wrap;
			gap: 0.5rem;
			justify-content: center;
			margin-bottom: 1rem;
		}

		.history-item {
			padding: 0.5rem 1rem;
			background-color: var(--ios-input-bg);
			color: var(--ios-text);
			border: none;
			border-radius: 20px;
			font-size: 0.9rem;
			cursor: pointer;
			-webkit-appearance: none;
			appearance: none;
			font-weight: 500;
			box-shadow: none;
		}

		.history-item:hover {
			background-color: var(--ios-input-bg-focus);
		}

		.history-item:active {
			background-color: var(--ios-blue);
			color: white;
		}

		.clear-history-btn {
			padding: 0.4rem 0.8rem;
			background-color: transparent;
			color: var(--ios-text-secondary);
			border: 1px solid var(--ios-border);
			border-radius: 8px;
			font-size: 0.8rem;
			cursor: pointer;
			display: block;
			margin: 0 auto;
			font-weight: 500;
			box-shadow: none;
		}

		.clear-history-btn:hover {
			background-color: var(--ios-input-bg);
			color: var(--ios-text);
		}

		/* Results state - move search to top */
		.container.has-results {
			justify-content: flex-start;
			padding-top: 2rem;
		}

		.container.has-results .search-section {
			max-width: 700px;
			margin-bottom: 0.5rem;
		}

		.container.has-results .vocabulary-section {
			max-width: 700px;
			margin-top: 0.5rem;
		}

		@media (min-width: 640px) {
			.search-form {
				flex-direction: row;
			}
		}

		@media (max-width: 640px) {
			.container {
				padding: 1rem;
			}

			.word-title {
				font-size: 1.75rem;
			}

			.search-container input {
				font-size: 1rem;
				padding: 0.875rem 0.75rem 0.875rem 2.25rem;
			}

			.history-item {
				font-size: 0.85rem;
				padding: 0.4rem 0.8rem;
			}

			.clear-history-btn {
				font-size: 0.75rem;
				padding: 0.3rem 0.6rem;
			}
		}

		/* Dark mode specific adjustments */
		@media (prefers-color-scheme: dark) {
			.error-card {
				background-color: rgba(255, 69, 58, 0.15);
				border-color: rgba(255, 69, 58, 0.3);
			}

			.word-card {
				box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
			}

			.vocabulary-toggle:hover {
				background-color: rgba(10, 132, 255, 0.1);
			}

			.vocabulary-toggle.active {
				background-color: rgba(10, 132, 255, 0.15);
			}

			.vocabulary-list {
				box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
			}

			.stats-content {
				box-shadow: 0 8px 40px rgba(0, 0, 0, 0.6);
			}

			.stats-close {
				background-color: rgba(118, 118, 128, 0.24);
			}

			.stats-close:hover {
				background-color: rgba(118, 118, 128, 0.32);
			}

			.stat-card {
				background-color: rgba(118, 118, 128, 0.24);
				border-color: rgba(84, 84, 88, 0.6);
			}

			.stats-action-btn {
				background-color: rgba(118, 118, 128, 0.24);
				border-color: rgba(84, 84, 88, 0.6);
			}

			.stats-action-btn:hover {
				background-color: rgba(118, 118, 128, 0.32);
			}

			.word-history-sidebar {
				box-shadow: -4px 0 20px rgba(0, 0, 0, 0.4);
			}

			.word-history-item {
				background-color: rgba(118, 118, 128, 0.24);
				border-color: rgba(84, 84, 88, 0.6);
			}

			.word-history-item:hover {
				background-color: rgba(118, 118, 128, 0.32);
			}
		}

		/* Statistics Section Styles */
		.stats-section {
			width: 100%;
			max-width: 500px;
			margin-top: 0.5rem;
			margin-bottom: 1rem;
		}

		.stats-toggle {
			width: 100%;
			display: flex;
			justify-content: center;
			align-items: center;
			gap: 0.5rem;
			padding: 0.5rem;
			background-color: transparent;
			color: var(--ios-blue);
			border: none;
			border-radius: 8px;
			font-size: 0.9rem;
			font-weight: 600;
			cursor: pointer;
			box-shadow: none;
		}

		.stats-toggle:hover {
			background-color: rgba(0, 122, 255, 0.05);
		}

		.stats-toggle.active {
			background-color: rgba(0, 122, 255, 0.1);
		}

		.stats-content {
			margin-top: 0.5rem;
			padding: 0.75rem;
			background-color: var(--ios-card);
			border-radius: 12px;
			border: 1px solid var(--ios-border);
			box-shadow: 0 4px 12px var(--ios-shadow);
		}

		.stats-content.hidden {
			display: none;
		}

		.stats-grid {
			display: grid;
			grid-template-columns: repeat(2, 1fr);
			gap: 1rem;
			margin-bottom: 1rem;
		}

		.stat-card {
			background-color: var(--ios-input-bg);
			padding: 0.75rem;
			border-radius: 8px;
			text-align: center;
		}

		.stat-value {
			font-size: 1.5rem;
			font-weight: 700;
			color: var(--ios-blue);
			margin-bottom: 0.25rem;
		}

		.stat-label {
			font-size: 0.8rem;
			color: var(--ios-text-secondary);
		}

		.monthly-stats {
			margin-top: 1rem;
		}

		.monthly-stats h4 {
			font-size: 0.9rem;
			margin-bottom: 0.5rem;
			color: var(--ios-text);
		}

		.monthly-bar {
			height: 8px;
			background-color: var(--ios-input-bg);
			border-radius: 4px;
			margin-bottom: 0.5rem;
			overflow: hidden;
		}

		.monthly-bar-fill {
			height: 100%;
			background-color: var(--ios-blue);
			border-radius: 4px;
			transition: width 0.3s ease;
		}

		.monthly-label {
			display: flex;
			justify-content: space-between;
			font-size: 0.8rem;
			color: var(--ios-text-secondary);
		}

		.flashcard-btn {
			width: 100%;
			margin-top: 1rem;
			padding: 0.75rem;
			background-color: var(--ios-blue);
			color: white;
			border: none;
			border-radius: 8px;
			font-size: 0.9rem;
			font-weight: 600;
			cursor: pointer;
			display: flex;
			justify-content: center;
			align-items: center;
			gap: 0.5rem;
		}

		.flashcard-btn:hover {
			background-color: #0056d6;
		}

		.flashcard-modal {
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background-color: rgba(0, 0, 0, 0.5);
			backdrop-filter: blur(10px);
			-webkit-backdrop-filter: blur(10px);
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			z-index: 1000;
			opacity: 0;
			visibility: hidden;
			transition: opacity 0.3s ease, visibility 0.3s ease, backdrop-filter 0.3s ease;
			padding: 2rem;
		}

		.flashcard-modal.show {
			opacity: 1;
			visibility: visible;
		}

		.flashcard-content {
			background-color: var(--ios-card);
			padding: 2rem;
			border-radius: 16px;
			width: 90%;
			max-width: 500px;
			min-height: 300px;
			display: flex;
			flex-direction: column;
			justify-content: center;
			text-align: center;
			box-shadow: 0 4px 20px var(--ios-shadow);
			position: relative;
			margin-bottom: 1.5rem;
		}

		.flashcard-word {
			font-size: 2rem;
			font-weight: 700;
			margin-bottom: 1rem;
			color: var(--ios-text);
		}

		.flashcard-phonetic {
			font-size: 1rem;
			color: var(--ios-text-secondary);
			margin-bottom: 1.5rem;
		}

		.flashcard-reveal-hint {
			font-size: 0.9rem;
			color: var(--ios-text-secondary);
			font-style: italic;
			margin-bottom: 1rem;
			text-align: center;
		}

		.flashcard-definition {
			font-size: 1.1rem;
			line-height: 1.5;
			color: var(--ios-text);
			margin-bottom: 1.5rem;
			opacity: 0;
			transition: opacity 0.3s ease;
		}

		.flashcard-content:hover .flashcard-definition {
			opacity: 1;
		}

		.flashcard-error {
			color: var(--ios-red);
			font-style: italic;
			margin-bottom: 1rem;
		}

		.flashcard-google-btn {
			display: inline-flex;
			align-items: center;
			gap: 0.5rem;
			padding: 0.5rem 1rem;
			background-color: var(--ios-blue);
			color: white;
			text-decoration: none;
			border-radius: 8px;
			font-size: 0.9rem;
			font-weight: 500;
			margin-bottom: 1rem;
		}

		.flashcard-google-btn:hover {
			background-color: #0056d6;
		}

		.flashcard-nav {
			display: flex;
			justify-content: space-between;
			align-items: center;
			gap: 1rem;
			width: 90%;
			max-width: 500px;
		}

		.flashcard-nav button {
			padding: 1rem 2rem;
			background-color: var(--ios-blue);
			color: white;
			border: none;
			border-radius: 12px;
			font-size: 1rem;
			font-weight: 600;
			cursor: pointer;
			min-width: 120px;
			box-shadow: 0 2px 8px rgba(0, 122, 255, 0.2);
			transition: all 0.2s ease;
		}

		.flashcard-nav button:hover:not(:disabled) {
			background-color: #0056d6;
			transform: translateY(-1px);
			box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
		}

		.flashcard-nav button:active:not(:disabled) {
			transform: translateY(0);
			box-shadow: 0 2px 8px rgba(0, 122, 255, 0.2);
		}

		.flashcard-nav button:disabled {
			background-color: var(--ios-input-bg);
			color: var(--ios-text-secondary);
			opacity: 0.6;
			cursor: not-allowed;
			box-shadow: none;
			transform: none;
		}

		.flashcard-close {
			position: absolute;
			top: 1rem;
			right: 1rem;
			background: none;
			border: none;
			color: var(--ios-text);
			font-size: 1.5rem;
			cursor: pointer;
			padding: 0.5rem;
		}

		.flashcard-counter {
			position: absolute;
			top: 1rem;
			left: 1rem;
			background-color: var(--ios-input-bg);
			color: var(--ios-text-secondary);
			padding: 0.25rem 0.75rem;
			border-radius: 20px;
			font-size: 0.8rem;
			font-weight: 500;
		}

		.stats-actions {
			display: flex;
			flex-direction: column;
			gap: 0.75rem;
			margin-top: 1rem;
		}

		.stats-action-btn {
			padding: 1rem;
			border: none;
			border-radius: 12px;
			font-size: 1rem;
			font-weight: 600;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 0.5rem;
			text-decoration: none;
			transition: all 0.2s ease;
			background-color: var(--ios-input-bg);
			color: var(--ios-text);
			border: 1px solid var(--ios-border);
			min-height: 52px;
		}

		.stats-action-btn:hover {
			background-color: var(--ios-input-bg-focus);
		}

		.stats-action-btn:active {
			background-color: var(--ios-blue);
			color: white;
			transform: scale(0.98);
		}

		.flashcard-btn {
			background-color: var(--ios-blue);
			color: white;
			border-color: var(--ios-blue);
		}

		.flashcard-btn:hover {
			background-color: #0056d6;
			border-color: #0056d6;
		}

		.export-csv-btn {
			background-color: #34c759;
			color: white;
			border-color: #34c759;
		}

		.export-csv-btn:hover {
			background-color: #28a745;
			border-color: #28a745;
		}

		.reset-stats-btn {
			background-color: var(--ios-red);
			color: white;
			border-color: var(--ios-red);
		}

		.reset-stats-btn:hover {
			background-color: #cc2e24;
			border-color: #cc2e24;
		}

		@media (max-width: 640px) {
			.sidebar {
				bottom: 10px;
				right: 10px;
			}

			.stats-modal {
				padding: 0.5rem;
			}

			.stats-content {
				padding: 1.5rem;
				border-radius: 16px;
				max-height: 90vh;
			}

			.stats-title {
				font-size: 1.75rem;
				margin-bottom: 1.5rem;
			}

			.stats-close {
				top: 1rem;
				right: 1rem;
			}

			.stats-grid {
				grid-template-columns: 1fr;
				gap: 0.75rem;
				margin-bottom: 1.5rem;
			}

			.stat-card {
				padding: 1.25rem 1rem;
			}

			.stat-value {
				font-size: 1.75rem;
			}

			.stats-action-btn {
				padding: 0.875rem 1rem;
				font-size: 0.95rem;
				min-height: 48px;
			}

			/* Hide word history sidebar on mobile */
			.word-history-sidebar {
				display: none !important;
			}
		}

		/* Word History Sidebar */
		.word-history-sidebar {
			position: fixed;
			top: 0;
			right: 0;
			width: 250px;
			height: 100vh;
			background-color: var(--ios-card);
			border-left: 1px solid var(--ios-border);
			box-shadow: -4px 0 20px var(--ios-shadow);
			padding: 2rem 1rem 1rem;
			opacity: 0.3;
			transition: opacity 0.3s ease;
			z-index: 50;
			overflow-y: auto;
			display: none;
		}

		.word-history-sidebar:hover {
			opacity: 1;
		}

		.word-history-sidebar.show {
			display: block;
		}

		.word-history-title {
			font-size: 1.1rem;
			font-weight: 600;
			color: var(--ios-text);
			margin-bottom: 1rem;
			text-align: center;
			opacity: 0.7;
		}

		.word-history-list {
			display: flex;
			flex-direction: column;
			gap: 0.5rem;
		}

		.word-history-item {
			padding: 0.75rem;
			background-color: var(--ios-input-bg);
			border: 1px solid var(--ios-border);
			border-radius: 12px;
			font-size: 0.9rem;
			cursor: pointer;
			transition: all 0.2s ease;
			text-align: center;
			opacity: 0.8;
		}

		.word-history-item:hover {
			background-color: var(--ios-input-bg-focus);
			opacity: 1;
			transform: translateX(-2px);
		}

		.word-history-item:active {
			background-color: var(--ios-blue);
			color: white;
		}

		.word-history-toggle-section {
			border-top: 1px solid var(--ios-border);
			padding-top: 1.5rem;
			margin-top: 1.5rem;
		}

		.word-history-toggle-container {
			display: flex;
			align-items: center;
			justify-content: space-between;
			margin-bottom: 1rem;
		}

		.word-history-toggle-label {
			font-size: 1rem;
			font-weight: 500;
			color: var(--ios-text);
		}

		.word-history-toggle {
			position: relative;
			width: 50px;
			height: 30px;
			background-color: var(--ios-input-bg);
			border-radius: 15px;
			border: none;
			cursor: pointer;
			transition: background-color 0.3s ease;
		}

		.word-history-toggle.active {
			background-color: var(--ios-blue);
		}

		.word-history-toggle::after {
			content: '';
			position: absolute;
			top: 2px;
			left: 2px;
			width: 26px;
			height: 26px;
			background-color: white;
			border-radius: 50%;
			transition: transform 0.3s ease;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
		}

		.word-history-toggle.active::after {
			transform: translateX(20px);
		}

		.word-history-description {
			font-size: 0.85rem;
			color: var(--ios-text-secondary);
			line-height: 1.4;
		}

		/* Sidebar Styles */
		.sidebar {
			position: fixed;
			bottom: 20px;
			right: 20px;
			z-index: 100;
		}

		/* Ensure sidebar doesn't interfere with content */
		.container.history-enabled {
			/* No padding adjustment - let sidebar overlay */
		}

		.sidebar-tab {
			background-color: rgba(142, 142, 147, 0.2);
			color: var(--ios-text-secondary);
			padding: 0.5rem;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			cursor: pointer;
			box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
			width: 40px;
			height: 40px;
			border: 1px solid var(--ios-border);
			transition: background-color 0.2s ease, color 0.2s ease;
		}

		.sidebar-tab:hover {
			background-color: rgba(142, 142, 147, 0.3);
			color: var(--ios-text);
		}

		.sidebar-tab svg {
			width: 16px;
			height: 16px;
		}

		/* Stats Modal */
		.stats-modal {
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background-color: rgba(0, 0, 0, 0.5);
			backdrop-filter: blur(10px);
			-webkit-backdrop-filter: blur(10px);
			display: flex;
			justify-content: center;
			align-items: center;
			z-index: 1000;
			opacity: 0;
			visibility: hidden;
			transition: opacity 0.3s ease, visibility 0.3s ease, backdrop-filter 0.3s ease;
			padding: 1rem;
		}

		.stats-modal.show {
			opacity: 1;
			visibility: visible;
		}

		.stats-content {
			background-color: var(--ios-card);
			border-radius: 20px;
			border: 1px solid var(--ios-border);
			box-shadow: 0 8px 40px var(--ios-shadow);
			padding: 2rem;
			width: 100%;
			max-width: 500px;
			max-height: 85vh;
			overflow-y: auto;
			position: relative;
		}

		.stats-close {
			position: absolute;
			top: 1.25rem;
			right: 1.25rem;
			background-color: rgba(142, 142, 147, 0.12);
			border: none;
			color: var(--ios-text-secondary);
			font-size: 1.2rem;
			cursor: pointer;
			padding: 0.5rem;
			border-radius: 50%;
			width: 32px;
			height: 32px;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: background-color 0.2s ease, color 0.2s ease;
		}

		.stats-close:hover {
			background-color: rgba(142, 142, 147, 0.18);
			color: var(--ios-text);
		}

		.stats-title {
			font-size: 2rem;
			font-weight: 700;
			letter-spacing: -0.5px;
			color: var(--ios-text);
			margin-bottom: 2rem;
			text-align: center;
		}

		.stats-grid {
			display: grid;
			grid-template-columns: repeat(2, 1fr);
			gap: 1rem;
			margin-bottom: 2rem;
		}

		.stat-card {
			background-color: var(--ios-input-bg);
			padding: 1.5rem 1rem;
			border-radius: 16px;
			text-align: center;
			border: 1px solid var(--ios-border);
		}

		.stat-value {
			font-size: 2rem;
			font-weight: 700;
			color: var(--ios-blue);
			margin-bottom: 0.5rem;
		}

		.stat-label {
			font-size: 0.9rem;
			color: var(--ios-text-secondary);
			font-weight: 500;
		}

		@media (prefers-color-scheme: dark) {
			.sidebar-tab {
				background-color: rgba(118, 118, 128, 0.24);
			}

			.sidebar-tab:hover {
				background-color: rgba(118, 118, 128, 0.32);
			}
		}
	</style>
</head>

<body>
	<main class="container" id="main-container">
		<div class="search-section">
			<form class="search-form" id="search-form">
				<div class="search-container">
					<svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none"
						stroke="currentColor" stroke-width="2">
						<circle cx="11" cy="11" r="8"></circle>
						<path d="m21 21-4.35-4.35"></path>
					</svg>
					<input type="text" name="word" id="word-input"
						placeholder="Type a word and hit enter..." autofocus required>
				</div>
			</form>

			<div id="loading" class="loading">
				Searching...
			</div>
		</div>

		<div id="sidebar" class="sidebar">
			<div id="sidebar-tab" class="sidebar-tab">
				<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<path d="M12 20V10"></path>
					<path d="M18 20V4"></path>
					<path d="M6 20v-4"></path>
				</svg>
			</div>
		</div>

		<div id="word-history-sidebar" class="word-history-sidebar">
			<div class="word-history-title">Search History</div>
			<div id="word-history-list" class="word-history-list">
				<!-- History items will be dynamically added here -->
			</div>
		</div>

		<div id="stats-modal" class="stats-modal">
			<div class="stats-content">
				<button class="stats-close" id="stats-close">&times;</button>
				<h2 class="stats-title">Statistics</h2>
				<div class="stats-grid">
					<div class="stat-card">
						<div class="stat-value" id="total-words">0</div>
						<div class="stat-label">Total Words Learned</div>
					</div>
					<div class="stat-card">
						<div class="stat-value" id="today-words">0</div>
						<div class="stat-label">Words Learned Today</div>
					</div>
				</div>
				<div class="word-history-toggle-section">
					<div class="word-history-toggle-container">
						<label class="word-history-toggle-label">Word History</label>
						<button id="word-history-toggle" class="word-history-toggle"></button>
					</div>
					<p class="word-history-description">
						Show a sidebar with your search history on the right side of the screen. History appears greyed out until you hover over it.
					</p>
				</div>
				<div class="stats-actions">
					<button id="flashcard-btn" class="stats-action-btn flashcard-btn">
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
							<line x1="3" y1="9" x2="21" y2="9"></line>
							<line x1="9" y1="21" x2="9" y2="9"></line>
						</svg>
						Start Flashcards
					</button>
					<button id="export-csv-btn" class="stats-action-btn export-csv-btn">
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
							<polyline points="7,10 12,15 17,10"></polyline>
							<line x1="12" y1="15" x2="12" y2="3"></line>
						</svg>
						Export CSV
					</button>
					<button id="view-words-btn" class="stats-action-btn view-words-btn">
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
							<polyline points="15,3 21,3 21,9"></polyline>
							<line x1="10" y1="14" x2="21" y2="3"></line>
						</svg>
						View Words
					</button>
					<button id="reset-stats-btn" class="stats-action-btn reset-stats-btn">
						Reset Stats
					</button>
				</div>
			</div>
		</div>

		<div id="flashcard-modal" class="flashcard-modal">
			<div class="flashcard-content">
				<div class="flashcard-counter" id="flashcard-counter">1 / 1</div>
				<button class="flashcard-close">&times;</button>
				<div class="flashcard-word" id="flashcard-word"></div>
				<div class="flashcard-phonetic" id="flashcard-phonetic"></div>
				<div class="flashcard-reveal-hint">Hover to reveal definition</div>
				<div class="flashcard-definition" id="flashcard-definition"></div>
				<div id="flashcard-google-container" style="text-align: center; display: none;">
					<div class="flashcard-error">Word not found in dictionary</div>
					<a id="flashcard-google-link" href="#" target="_blank" class="flashcard-google-btn">
						<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
							<polyline points="15,3 21,3 21,9"></polyline>
							<line x1="10" y1="14" x2="21" y2="3"></line>
						</svg>
						Search on Google
					</a>
				</div>
			</div>
			<div class="flashcard-nav">
				<button id="prev-card">Previous</button>
				<button id="next-card">Next</button>
			</div>
		</div>

		<div id="results">
			<!-- Results will be loaded here -->
		</div>
	</main>

	<script>
		// Dictionary App Class
		class DictionaryApp {
			constructor() {
				this.stats = {
					totalWords: 0,
					todayWords: 0,
					lastSearchDate: null,
					monthlyStats: {},
					dailyStats: {}
				};
				this.lastSearchedWord = null;
				this.wordHistoryEnabled = false;
				this.init();
			}

			init() {
				this.setupEventListeners();
				this.loadHistory();
				this.loadStats();
				this.loadWordHistorySettings();
				this.showWelcomeIfFirstVisit();
				this.focusInput();
				this.updateStatsDisplay();
				this.updateWordHistorySidebar();
			}

			setupEventListeners() {
				// Search form submission
				document.getElementById('search-form').addEventListener('submit', (e) => {
					e.preventDefault();
					this.handleSearch();
				});

				// Stats modal toggle
				document.getElementById('sidebar-tab').addEventListener('click', () => {
					this.toggleStatsModal();
				});

				// Stats modal close
				document.getElementById('stats-close').addEventListener('click', () => {
					this.closeStatsModal();
				});

				// Clear history button
				document.getElementById('reset-stats-btn').addEventListener('click', () => {
					this.resetAllStats();
				});

				// Flashcard event listeners
				document.getElementById('flashcard-btn').addEventListener('click', () => {
					this.startFlashcards();
				});

				// Export CSV event listener
				document.getElementById('export-csv-btn').addEventListener('click', () => {
					this.exportWordsToCSV();
				});

				// View words event listener
				document.getElementById('view-words-btn').addEventListener('click', () => {
					this.viewWordsInNewTab();
				});

				// Word history toggle event listener
				document.getElementById('word-history-toggle').addEventListener('click', () => {
					this.toggleWordHistory();
				});

				document.querySelector('.flashcard-close').addEventListener('click', () => {
					this.closeFlashcards();
				});

				document.getElementById('prev-card').addEventListener('click', () => {
					this.showPreviousCard();
				});

				document.getElementById('next-card').addEventListener('click', () => {
					this.showNextCard();
				});

				// Click outside modals to close
				document.addEventListener('click', (event) => {
					const statsModal = document.getElementById('stats-modal');
					const flashcardModal = document.getElementById('flashcard-modal');
					
					if (event.target === statsModal) {
						this.closeStatsModal();
					}
					
					if (event.target === flashcardModal) {
						this.closeFlashcards();
					}
				});

				// Keyboard shortcuts
				document.addEventListener('keydown', (event) => {
					if (event.altKey && event.key === 'f') {
						this.startFlashcards();
					}
					
					// Close modals with Escape key
					if (event.key === 'Escape') {
						const statsModal = document.getElementById('stats-modal');
						const flashcardModal = document.getElementById('flashcard-modal');
						
						if (statsModal && statsModal.classList.contains('show')) {
							this.closeStatsModal();
						} else if (flashcardModal && flashcardModal.classList.contains('show')) {
							this.closeFlashcards();
						}
					}

					// Flashcard navigation with arrow keys
					const flashcardModal = document.getElementById('flashcard-modal');
					if (flashcardModal && flashcardModal.classList.contains('show')) {
						if (event.key === 'ArrowLeft') {
							event.preventDefault();
							this.showPreviousCard();
						} else if (event.key === 'ArrowRight') {
							event.preventDefault();
							this.showNextCard();
						}
					}
				});

				// Focus textbox when returning to tab
				window.addEventListener('focus', () => {
					// Only focus if no modal is open
					const statsModal = document.getElementById('stats-modal');
					const flashcardModal = document.getElementById('flashcard-modal');
					
					if ((!statsModal || !statsModal.classList.contains('show')) && 
						(!flashcardModal || !flashcardModal.classList.contains('show'))) {
						this.focusInput();
					}
				});

				// Event delegation for history items
				document.addEventListener('click', (event) => {
					if (event.target.classList.contains('history-item')) {
						const word = event.target.textContent;
						this.searchWord(word);
					}
					if (event.target.classList.contains('word-history-item')) {
						const word = event.target.textContent;
						this.searchWord(word);
					}
				});
			}

			focusInput() {
				const wordInput = document.getElementById('word-input');
				if (wordInput) {
					wordInput.focus();
				}
			}

			async handleSearch() {
				const wordInput = document.getElementById('word-input');
				const query = wordInput.value.trim();

				if (!query) {
					this.showError('Please enter a word');
					return;
				}

				this.showLoading(true);
				this.lastSearchedWord = query;
				this.addToHistory(query);
				this.updateStats(query);

				try {
					const results = await this.fetchDefinition(query);
					this.displayResults(results, query);
					this.updateLayout();
				} catch (error) {
					// Show a simple message for word not found (Google search already opened)
					if (error.message.includes('not found in dictionary')) {
						this.showError(error.message);
					} else {
						this.showError(error.message);
					}
				} finally {
					this.showLoading(false);
					wordInput.value = '';
					this.focusInput();
				}
			}

			async fetchDefinition(word) {
				const apiURL = `https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(word)}`;

				try {
					console.log('Fetching definition for:', word);
					const response = await fetch(apiURL);
					console.log('API Response status:', response.status);

					if (response.status === 404) {
						// Word not found - automatically redirect to Google search
						const googleSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(word + ' meaning definition')}`;
						window.open(googleSearchUrl, '_blank');
						throw new Error(`Word "${word}" not found in dictionary. Opened Google search in new tab.`);
					}

					if (!response.ok) {
						throw new Error(`Failed to fetch dictionary data: ${response.status} ${response.statusText}`);
					}

					const data = await response.json();
					console.log('API Response data:', data);
					return data;
				} catch (error) {
					console.error('Error fetching definition:', error);
					if (error.message.includes('fetch')) {
						throw new Error('Network error. Please check your internet connection.');
					}
					throw error;
				}
			}

			async fetchDefinitionForFlashcard(word) {
				const apiURL = `https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(word)}`;

				try {
					console.log('Fetching definition for flashcard:', word);
					const response = await fetch(apiURL);
					console.log('API Response status:', response.status);

					if (response.status === 404) {
						// For flashcards, just return null instead of opening Google
						return null;
					}

					if (!response.ok) {
						throw new Error(`Failed to fetch dictionary data: ${response.status} ${response.statusText}`);
					}

					const data = await response.json();
					console.log('API Response data:', data);
					return data;
				} catch (error) {
					console.error('Error fetching definition for flashcard:', error);
					return null;
				}
			}

			displayResults(results, query) {
				const resultsContainer = document.getElementById('results');
				console.log('Displaying results for:', query, results);

				if (!results || results.length === 0) {
					this.showError('No results found');
					return;
				}

				try {
					const entry = results[0];
					let html = '<div class="results-container">';
					html += '<div class="word-card">';
					html += '<div class="word-header">';
					html += `<h2 class="word-title">${entry.word}</h2>`;
					
					// Add Google search link
					const googleSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(entry.word + ' meaning')}`;
					html += `<a href="${googleSearchUrl}" target="_blank" class="google-search-link">`;
					html += '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">';
					html += '<path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>';
					html += '<polyline points="15,3 21,3 21,9"></polyline>';
					html += '<line x1="10" y1="14" x2="21" y2="3"></line>';
					html += '</svg>';
					html += 'Google';
					html += '</a>';

					if (entry.phonetic) {
						html += `<span class="phonetic">${entry.phonetic}</span>`;
					}

					html += '</div>';

					// Audio pronunciation
					const audioUrl = this.findAudioUrl(entry.phonetics);
					if (audioUrl) {
						html += '<div class="audio-container">';
						html += `<audio id="pronunciation-audio" src="${audioUrl}" preload="auto"></audio>`;
						html += '<button id="replay-pronunciation" class="replay-button">';
						html += '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">';
						html += '<polygon points="5 3 19 12 5 21 5 3"></polygon>';
						html += '</svg>';
						html += 'Play pronunciation';
						html += '</button>';
						html += '</div>';
					}

					// Meanings
					if (entry.meanings && entry.meanings.length > 0) {
						entry.meanings.forEach(meaning => {
							html += '<div class="meaning-section">';
							html += `<h3 class="part-of-speech">${meaning.partOfSpeech}</h3>`;

							if (meaning.definitions && meaning.definitions.length > 0) {
								html += '<ol class="definitions-list">';
								meaning.definitions.forEach(def => {
									html += '<li class="definition-item">';
									html += `<p class="definition">${def.definition}</p>`;

									if (def.example) {
										html += `<p class="example">"${def.example}"</p>`;
									}

									if (def.synonyms && def.synonyms.length > 0) {
										html += '<div class="synonyms">';
										html += '<span class="label">Synonyms: </span>';
										html += `<span>${def.synonyms.join(', ')}</span>`;
										html += '</div>';
									}

									html += '</li>';
								});
								html += '</ol>';
							} else {
								html += '<p class="definition">No definitions found.</p>';
							}

							html += '</div>';
						});
					} else {
						html += '<p class="definition">No definitions found.</p>';
					}

					html += '</div>';
					html += '</div>';

					resultsContainer.innerHTML = html;
					console.log('Results displayed successfully');

					// Auto-play pronunciation
					if (audioUrl) {
						setTimeout(() => {
							const audio = document.getElementById('pronunciation-audio');
							if (audio) {
								audio.play().catch(error => {
									console.log('Autoplay prevented by browser policy.');
									const replayButton = document.getElementById('replay-pronunciation');
									if (replayButton) {
										replayButton.classList.add('highlight');
									}
								});
							}
						}, 100);

						// Setup replay button
						const replayButton = document.getElementById('replay-pronunciation');
						if (replayButton) {
							replayButton.addEventListener('click', () => {
								const audio = document.getElementById('pronunciation-audio');
								if (audio) {
									audio.play();
								}
							});
						}
					}
				} catch (error) {
					console.error('Error displaying results:', error);
					this.showError('Error displaying results. Please try again.');
				}
			}

			findAudioUrl(phonetics) {
				if (!phonetics) return null;

				for (const phonetic of phonetics) {
					if (phonetic.audio) {
						return phonetic.audio;
					}
				}
				return null;
			}

			showError(message, searchWord = null) {
				console.error('Error:', message);
				const resultsContainer = document.getElementById('results');
				
				let html = `<div class="error-card">${message}`;
				
				// Add Google search option if it's a "word not found" error and we have a search word
				if (message.includes('Word not found') && searchWord) {
					const googleSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(searchWord + ' meaning definition')}`;
					html += '<div class="error-actions">';
					html += `<a href="${googleSearchUrl}" target="_blank" class="search-google-btn">`;
					html += '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">';
					html += '<path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>';
					html += '<polyline points="15,3 21,3 21,9"></polyline>';
					html += '<line x1="10" y1="14" x2="21" y2="3"></line>';
					html += '</svg>';
					html += 'Search on Google';
					html += '</a>';
					html += '</div>';
				}
				
				html += '</div>';
				resultsContainer.innerHTML = html;
			}

			showLoading(show) {
				const loading = document.getElementById('loading');
				if (show) {
					loading.classList.add('show');
					console.log('Loading started');
				} else {
					loading.classList.remove('show');
					console.log('Loading finished');
				}
			}

			updateLayout() {
				const container = document.getElementById('main-container');
				const results = document.getElementById('results');

				if (results && results.innerHTML.trim()) {
					container.classList.add('has-results');
					this.updateHistoryDisplay();
				}
			}

			searchWord(word) {
				const wordInput = document.getElementById('word-input');
				if (wordInput) {
					wordInput.value = word;
					this.handleSearch();
				}
			}

			// History Management
			getHistory() {
				try {
					const history = localStorage.getItem('dictionary-history');
					return history ? JSON.parse(history) : [];
				} catch (error) {
					console.error('Error loading history:', error);
					return [];
				}
			}

			saveHistory(history) {
				try {
					localStorage.setItem('dictionary-history', JSON.stringify(history));
				} catch (error) {
					console.error('Error saving history:', error);
				}
			}

			addToHistory(word) {
				let history = this.getHistory();

				// Remove if already exists (to avoid duplicates)
				history = history.filter(w => w.toLowerCase() !== word.toLowerCase());

				// Add to beginning
				history.unshift(word);

				// Keep only last 10 searches
				if (history.length > 10) {
					history = history.slice(0, 10);
				}

				this.saveHistory(history);
				this.updateHistoryDisplay();
			}

			loadHistory() {
				this.updateHistoryDisplay();
			}

			updateHistoryDisplay() {
				const history = this.getHistory();
				const sidebar = document.getElementById('sidebar');

				if (history.length > 0 || this.stats.totalWords > 0) {
					sidebar.style.display = 'block';
				} else {
					sidebar.style.display = 'none';
				}

				// Update word history sidebar
				this.updateWordHistorySidebar();
			}

			clearHistory() {
				this.saveHistory([]);
				this.updateHistoryDisplay();
			}

			// Stats Management
			loadStats() {
				try {
					const savedStats = localStorage.getItem('dictionary-stats');
					if (savedStats) {
						this.stats = JSON.parse(savedStats);
					}
				} catch (error) {
					console.error('Error loading stats:', error);
				}
			}

			saveStats() {
				try {
					localStorage.setItem('dictionary-stats', JSON.stringify(this.stats));
				} catch (error) {
					console.error('Error saving stats:', error);
				}
			}

			updateStats(word) {
				const today = new Date().toISOString().split('T')[0];
				const month = today.substring(0, 7);

				// Update total words
				this.stats.totalWords++;

				// Update daily stats
				if (!this.stats.dailyStats[today]) {
					this.stats.dailyStats[today] = [];
				}
				this.stats.dailyStats[today].push(word);

				// Update monthly stats
				if (!this.stats.monthlyStats[month]) {
					this.stats.monthlyStats[month] = 0;
				}
				this.stats.monthlyStats[month]++;

				this.stats.lastSearchDate = today;
				this.stats.todayWords = this.stats.dailyStats[today].length;

				this.saveStats();
				this.updateStatsDisplay();
			}

			updateStatsDisplay() {
				try {
					// Update stats values
					document.getElementById('total-words').textContent = this.stats.totalWords || 0;
					document.getElementById('today-words').textContent = this.stats.todayWords || 0;

					// Show/hide sidebar based on whether there are any stats or history
					const sidebar = document.getElementById('sidebar');
					const hasStats = this.stats.totalWords > 0;
					const hasHistory = this.getHistory().length > 0;
					
					if (hasStats || hasHistory) {
						sidebar.style.display = 'block';
					} else {
						sidebar.style.display = 'none';
					}
				} catch (error) {
					console.error('Error updating stats display:', error);
				}
			}

			updateMonthlyChart() {
				// Monthly chart functionality removed
			}

			// Flashcard functionality
			startFlashcards() {
				const history = this.getHistory();
				if (history.length === 0) {
					alert('No words in history to create flashcards');
					return;
				}

				this.flashcardWords = [...history];
				this.currentCardIndex = 0;
				this.flashcardDefinitions = {}; // Cache definitions
				this.preloadFlashcardDefinitions();
				this.showCurrentCard();
				document.getElementById('flashcard-modal').classList.add('show');
			}

			closeFlashcards() {
				document.getElementById('flashcard-modal').classList.remove('show');
				this.flashcardWords = null;
				this.flashcardDefinitions = {};
				this.currentCardIndex = 0;
			}

			async preloadFlashcardDefinitions() {
				// Preload definitions for better performance
				const promises = this.flashcardWords.map(async (word) => {
					if (!this.flashcardDefinitions[word]) {
						try {
							const results = await this.fetchDefinitionForFlashcard(word);
							if (results && results.length > 0) {
								this.flashcardDefinitions[word] = results[0];
							}
						} catch (error) {
							console.error(`Error preloading definition for ${word}:`, error);
						}
					}
				});

				await Promise.all(promises);
			}

			showCurrentCard() {
				if (!this.flashcardWords || this.currentCardIndex >= this.flashcardWords.length) return;

				const word = this.flashcardWords[this.currentCardIndex];
				const entry = this.flashcardDefinitions[word];
				const googleContainer = document.getElementById('flashcard-google-container');
				const googleLink = document.getElementById('flashcard-google-link');

				// Update navigation button states and counter
				const prevButton = document.getElementById('prev-card');
				const nextButton = document.getElementById('next-card');
				const counter = document.getElementById('flashcard-counter');
				
				prevButton.disabled = this.currentCardIndex === 0;
				nextButton.disabled = this.currentCardIndex === this.flashcardWords.length - 1;
				counter.textContent = `${this.currentCardIndex + 1} / ${this.flashcardWords.length}`;

				if (entry) {
					document.getElementById('flashcard-word').textContent = entry.word;
					document.getElementById('flashcard-phonetic').textContent = entry.phonetic || '';
					document.getElementById('flashcard-definition').textContent = 
						entry.meanings[0]?.definitions[0]?.definition || 'No definition available';
					googleContainer.style.display = 'none';
				} else {
					// Show word and loading state
					document.getElementById('flashcard-word').textContent = word;
					document.getElementById('flashcard-phonetic').textContent = '';
					document.getElementById('flashcard-definition').textContent = 'Loading definition...';
					googleContainer.style.display = 'none';
					
					this.fetchDefinitionForFlashcard(word).then(results => {
						if (results && results.length > 0) {
							const entry = results[0];
							this.flashcardDefinitions[word] = entry;
							// Update display if still on the same card
							if (this.flashcardWords[this.currentCardIndex] === word) {
								document.getElementById('flashcard-word').textContent = entry.word;
								document.getElementById('flashcard-phonetic').textContent = entry.phonetic || '';
								document.getElementById('flashcard-definition').textContent = 
									entry.meanings[0]?.definitions[0]?.definition || 'No definition available';
								googleContainer.style.display = 'none';
							}
						} else {
							// Word not found - show Google search option
							if (this.flashcardWords[this.currentCardIndex] === word) {
								document.getElementById('flashcard-definition').textContent = '';
								const googleSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(word + ' meaning definition')}`;
								googleLink.href = googleSearchUrl;
								googleContainer.style.display = 'block';
							}
						}
					});
				}
			}

			showPreviousCard() {
				if (this.currentCardIndex > 0) {
					this.currentCardIndex--;
					this.showCurrentCard();
				}
			}

			showNextCard() {
				if (this.currentCardIndex < this.flashcardWords.length - 1) {
					this.currentCardIndex++;
					this.showCurrentCard();
				}
			}

			resetAllStats() {
				const confirmed = confirm('Are you sure you want to reset all statistics and vocabulary history? This action cannot be undone.');
				
				if (confirmed) {
					// Reset stats
					this.stats = {
						totalWords: 0,
						currentStreak: 0,
						longestStreak: 0,
						todayWords: 0,
						lastSearchDate: null,
						monthlyStats: {},
						dailyStats: {}
					};
					
					// Clear history
					this.saveHistory([]);
					
					// Save empty stats
					this.saveStats();
					
					// Update displays
					this.updateStatsDisplay();
					this.updateHistoryDisplay();
					
					// Close modal after reset
					this.closeStatsModal();
				}
			}

			toggleStatsModal() {
				const statsModal = document.getElementById('stats-modal');
				statsModal.classList.toggle('show');
			}

			closeStatsModal() {
				const statsModal = document.getElementById('stats-modal');
				statsModal.classList.remove('show');
			}

			showWelcomeIfFirstVisit() {
				const hasVisited = localStorage.getItem('dictionary-has-visited');
				if (!hasVisited) {
					this.showWelcome();
					localStorage.setItem('dictionary-has-visited', 'true');
				}
			}

			showWelcome() {
				const resultsContainer = document.getElementById('results');
				const container = document.getElementById('main-container');
				
				let html = '<div class="welcome-container">';
				html += '<div class="welcome-card">';
				html += '<div class="welcome-header">';
				html += '<h2 class="welcome-title">No Fluff Dictionary</h2>';
				html += '<span class="phonetic">/noÊŠ flÊŒf ËˆdÉªkÊƒÉ™ËŒnÉ›ri/</span>';
				html += '</div>';

				html += '<div class="welcome-section">';
				html += '<p class="welcome-description">';
				html += 'Every other dictionary app is bloated. I wanted something clean, fast, and minimal for my focused reading sessions.';
				html += '</p>';
				html += '<p class="welcome-description">';
				html += 'Everything stays local on your browser.';
				html += '</p>';
				
				html += '<p style="margin-top: 1.5rem; text-align: center;">';
				html += '<a href="https://github.com/me-heer/go-dict" target="_blank" class="repo-link">';
				html += 'View on GitHub';
				html += '</a>';
				html += '</p>';

				html += '</div>';
				html += '</div>';
				html += '</div>';

				resultsContainer.innerHTML = html;
				container.classList.add('has-results');
			}

			exportWordsToCSV() {
				const history = this.getHistory();
				if (history.length === 0) {
					alert('No words to export');
					return;
				}

				// Create CSV content
				let csvContent = 'Word,Search Date,Search Count\n';
				
				// Count occurrences of each word across all daily stats
				const wordCounts = {};
				const wordDates = {};
				
				Object.keys(this.stats.dailyStats).forEach(date => {
					this.stats.dailyStats[date].forEach(word => {
						wordCounts[word] = (wordCounts[word] || 0) + 1;
						if (!wordDates[word]) {
							wordDates[word] = date;
						}
					});
				});

				// Add words from history (including those not in daily stats)
				history.forEach(word => {
					if (!wordCounts[word]) {
						wordCounts[word] = 1;
						wordDates[word] = new Date().toISOString().split('T')[0];
					}
				});

				// Generate CSV rows
				Object.keys(wordCounts).forEach(word => {
					const date = wordDates[word] || new Date().toISOString().split('T')[0];
					const count = wordCounts[word];
					csvContent += `"${word}","${date}",${count}\n`;
				});

				// Create and download file
				const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
				const link = document.createElement('a');
				const url = URL.createObjectURL(blob);
				link.setAttribute('href', url);
				link.setAttribute('download', `dictionary-words-${new Date().toISOString().split('T')[0]}.csv`);
				link.style.visibility = 'hidden';
				document.body.appendChild(link);
				link.click();
				document.body.removeChild(link);
			}

			viewWordsInNewTab() {
				const history = this.getHistory();
				if (history.length === 0) {
					alert('No words to view');
					return;
				}

				// Create HTML content for new tab
				let htmlContent = `
				<!DOCTYPE html>
				<html lang="en">
				<head>
					<meta charset="UTF-8">
					<meta name="viewport" content="width=device-width, initial-scale=1.0">
					<title>Dictionary Words - No Fluff Dictionary</title>
					<style>
						body {
							font-family: -apple-system, BlinkMacSystemFont, "San Francisco", "Helvetica Neue", sans-serif;
							line-height: 1.6;
							color: #333;
							max-width: 800px;
							margin: 0 auto;
							padding: 2rem;
							background-color: #f8f9fa;
						}
						.header {
							text-align: center;
							margin-bottom: 2rem;
							padding-bottom: 1rem;
							border-bottom: 2px solid #007aff;
						}
						.header h1 {
							color: #007aff;
							margin-bottom: 0.5rem;
						}
						.stats {
							background: white;
							padding: 1rem;
							border-radius: 8px;
							margin-bottom: 2rem;
							box-shadow: 0 2px 4px rgba(0,0,0,0.1);
						}
						.word-list {
							background: white;
							padding: 1.5rem;
							border-radius: 8px;
							box-shadow: 0 2px 4px rgba(0,0,0,0.1);
						}
						.word-item {
							padding: 0.75rem;
							border-bottom: 1px solid #eee;
							display: flex;
							justify-content: space-between;
							align-items: center;
						}
						.word-item:last-child {
							border-bottom: none;
						}
						.word {
							font-weight: 600;
							color: #333;
						}
						.word-meta {
							font-size: 0.9rem;
							color: #666;
						}
						.export-note {
							text-align: center;
							margin-top: 2rem;
							color: #666;
							font-style: italic;
						}
					</style>
				</head>
				<body>
					<div class="header">
						<h1>Your Vocabulary</h1>
						<p>Words searched using No Fluff Dictionary</p>
					</div>
					
					<div class="stats">
						<h3>Statistics</h3>
						<p><strong>Total Words:</strong> ${this.stats.totalWords}</p>
						<p><strong>Unique Words:</strong> ${history.length}</p>
						<p><strong>Words Today:</strong> ${this.stats.todayWords}</p>
					</div>
					
					<div class="word-list">
						<h3>Word List (${history.length} words)</h3>
				`;

				// Add word counts
				const wordCounts = {};
				Object.keys(this.stats.dailyStats).forEach(date => {
					this.stats.dailyStats[date].forEach(word => {
						wordCounts[word] = (wordCounts[word] || 0) + 1;
					});
				});

				history.forEach((word, index) => {
					const count = wordCounts[word] || 1;
					const plural = count === 1 ? 'time' : 'times';
					htmlContent += `
						<div class="word-item">
							<span class="word">${index + 1}. ${word}</span>
							<span class="word-meta">Searched ${count} ${plural}</span>
						</div>
					`;
				});

				htmlContent += `
					</div>
					<div class="export-note">
						<p>Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}</p>
						<p>From <a href="${window.location.href}" target="_blank">No Fluff Dictionary</a></p>
					</div>
				</body>
				</html>
				`;

				// Open in new tab
				const newTab = window.open();
				newTab.document.write(htmlContent);
				newTab.document.close();
			}

			// Word History Management
			loadWordHistorySettings() {
				try {
					const saved = localStorage.getItem('dictionary-word-history-enabled');
					this.wordHistoryEnabled = saved === 'true';
					this.updateWordHistoryToggle();
					this.updateWordHistoryDisplay();
				} catch (error) {
					console.error('Error loading word history settings:', error);
				}
			}

			saveWordHistorySettings() {
				try {
					localStorage.setItem('dictionary-word-history-enabled', this.wordHistoryEnabled.toString());
				} catch (error) {
					console.error('Error saving word history settings:', error);
				}
			}

			toggleWordHistory() {
				this.wordHistoryEnabled = !this.wordHistoryEnabled;
				this.saveWordHistorySettings();
				this.updateWordHistoryToggle();
				this.updateWordHistoryDisplay();
			}

			updateWordHistoryToggle() {
				const toggle = document.getElementById('word-history-toggle');
				if (toggle) {
					if (this.wordHistoryEnabled) {
						toggle.classList.add('active');
					} else {
						toggle.classList.remove('active');
					}
				}
			}

			updateWordHistoryDisplay() {
				const container = document.getElementById('main-container');
				const sidebar = document.getElementById('word-history-sidebar');

				if (this.wordHistoryEnabled) {
					container.classList.add('history-enabled');
					sidebar.classList.add('show');
				} else {
					container.classList.remove('history-enabled');
					sidebar.classList.remove('show');
				}
			}

			updateWordHistorySidebar() {
				if (!this.wordHistoryEnabled) return;

				const history = this.getHistory();
				const historyList = document.getElementById('word-history-list');
				
				if (!historyList) return;

				if (history.length === 0) {
					historyList.innerHTML = '<div style="text-align: center; color: var(--ios-text-secondary); font-style: italic; padding: 1rem;">No words searched yet</div>';
					return;
				}

				let html = '';
				history.forEach(word => {
					html += `<div class="word-history-item">${word}</div>`;
				});

				historyList.innerHTML = html;
			}
		}

		// Initialize the app when DOM is loaded
		document.addEventListener('DOMContentLoaded', () => {
			new DictionaryApp();
		});
	</script>
</body>

</html>
